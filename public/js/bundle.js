var w=class{routes=[];add(t,s){let n=t.replace(/:(\w+)/g,"(?<$1>[^/]+)");this.routes.push({pattern:new RegExp(`^${n}$`),handler:s})}start(){window.addEventListener("hashchange",()=>this.resolve()),this.resolve()}navigate(t){location.hash=t}resolve(){let t=location.hash.slice(1)||"/";for(let s of this.routes){let n=t.match(s.pattern);if(n){s.handler(n.groups??{});return}}this.routes.length>0&&this.routes[0].handler({})}};var x=class{state={connected:!1,gameState:null,agents:[],selectedAgentIds:new Set,route:location.hash||"#/"};listeners=new Set;getState(){return this.state}update(t){this.state={...this.state,...t},this.notify()}subscribe(t){return this.listeners.add(t),()=>this.listeners.delete(t)}notify(){for(let t of this.listeners)t()}},g=new x;function e(r,t={},...s){let n=document.createElement(r);for(let[o,i]of Object.entries(t))o.startsWith("data-")?n.setAttribute(o,i):o==="class"?n.className=i:o==="for"?n.setAttribute("for",i):n.setAttribute(o,i);for(let o of s)n.append(typeof o=="string"?document.createTextNode(o):o);return n}function p(r,...t){r.replaceChildren(...t)}function $(r,t){let s=e("div",{class:"hero-logo"},e("span",{class:"logo-soul-left"},"SOUL"),e("span",{class:"logo-vs"}," vs "),e("span",{class:"logo-soul-right"},"SOUL")),n=e("p",{class:"hero-tagline"},"Upload your soul. Fight to win."),o=e("button",{class:"btn btn-cta",type:"button","aria-label":"Choose your fighter"},"Choose Your Fighter \u2192");o.addEventListener("click",t);let i=e("div",{class:"hero-preview"},e("div",{class:"preview-tile"},e("span",{class:"preview-emoji"},"\u{1F9E0}"),e("span",{class:"preview-vs"},"vs"),e("span",{class:"preview-emoji"},"\u{1F525}"))),m=e("section",{class:"landing-hero"},s,n,o,i);p(r,m)}function R(r,t="Loading\u2026"){let s=e("div",{class:"loading-spinner",role:"status","aria-label":t},e("div",{class:"spinner-ring"}),e("p",{class:"loading-text"},t));p(r,s)}function y(r,t,s){let n=[e("div",{class:"error-icon"},"\u26A0\uFE0F"),e("h2",{class:"error-title"},"Something went wrong"),e("p",{class:"error-message",role:"alert"},t)];if(s){let i=e("button",{class:"btn btn-primary",type:"button","aria-label":"Retry"},"\u{1F504} Try Again");i.addEventListener("click",s),n.push(i)}let o=e("section",{class:"error-state"},...n);p(r,o)}var B="/api/v1";async function C(r,t={}){let s=await fetch(`${B}${r}`,{headers:{"Content-Type":"application/json",...t.headers},credentials:"include",...t});if(!s.ok){let n=await s.json().catch(()=>({error:"UNKNOWN",message:s.statusText}));throw new I(n.error??"UNKNOWN",n.message??s.statusText,s.status)}return s.json()}var I=class extends Error{constructor(s,n,o){super(n);this.code=s;this.status=o;this.name="ApiError"}};function L(){return C("/agents")}function T(r){return C(`/games/${encodeURIComponent(r)}`)}function k(r,t="elimination"){return C("/games",{method:"POST",body:JSON.stringify({agents:r,mode:t})})}function D(r){return C(`/games/${encodeURIComponent(r)}/start`,{method:"POST"})}function P(r){return C(`/games/${encodeURIComponent(r)}/results`)}function U(r){let t=new Set,s=[],n=!0,o=null;function i(){if(n){R(r,"Loading fighters\u2026");return}if(o){y(r,o,()=>void u());return}let c=e("header",{class:"picker-header"},e("h1",{},"\u2694\uFE0F Choose Your Fighters"),e("p",{},"Select 2 or more agents to battle")),l=e("div",{class:"agent-grid",role:"group","aria-label":"Agent selection"});for(let d of s){let f=e("button",{class:`agent-tile${t.has(d.id)?" selected":""}`,"aria-pressed":t.has(d.id)?"true":"false","aria-label":`Select ${d.name}`,"data-id":d.id,type:"button"},e("div",{class:"emoji"},"\u{1F916}"),e("div",{class:"name"},d.name),e("div",{class:"desc"},d.personality??""));f.addEventListener("click",()=>m(d.id)),l.append(f)}let h=e("button",{class:"btn btn-primary",type:"button","aria-label":"Start game"},"\u{1F3AE} Start Game");t.size<2&&h.setAttribute("disabled",""),h.addEventListener("click",()=>void v());let a=e("div",{class:"picker-actions"},h);p(r,c,l,a)}function m(c){t.has(c)?t.delete(c):t.add(c),g.update({selectedAgentIds:new Set(t)}),i()}async function v(){if(!(t.size<2))try{R(r,"Creating game\u2026");let c=await k([...t]);await D(c.id),location.hash=`#/game/${c.id}`}catch(c){y(r,c instanceof Error?c.message:"Failed to create game",()=>i())}}async function u(){n=!0,o=null,i();try{let c=await L();s=Array.isArray(c)?c:c.agents,n=!1}catch(c){n=!1,o=c instanceof Error?c.message:"Failed to load agents"}i()}u()}var A=class{ws=null;reconnectAttempts=0;maxReconnectAttempts=10;gameId=null;reconnectTimer=null;onFullState;onRoundStart;onChallenge;onResponse;onElimination;onGameEnd;onError;onDisconnected;onConnectionChange;connect(t){this.gameId=t,this.reconnectAttempts=0,this.doConnect()}disconnect(){this.gameId=null,this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=null),this.ws&&(this.ws.close(1e3,"Client disconnect"),this.ws=null)}doConnect(){if(!this.gameId)return;let s=`${location.protocol==="https:"?"wss:":"ws:"}//${location.host}/ws`;this.ws=new WebSocket(s),this.ws.onopen=()=>{this.reconnectAttempts=0,this.onConnectionChange?.(!0),this.ws.send(JSON.stringify({type:"SUBSCRIBE",gameId:this.gameId})),this.ws.send(JSON.stringify({type:"RESYNC",gameId:this.gameId}))},this.ws.onmessage=n=>{try{let o=JSON.parse(n.data);this.handleMessage(o)}catch{}},this.ws.onclose=n=>{this.onConnectionChange?.(!1),!(n.code===1e3||n.code===1001)&&this.scheduleReconnect()},this.ws.onerror=()=>{this.ws?.close()}}scheduleReconnect(){if(!this.gameId)return;if(this.reconnectAttempts>=this.maxReconnectAttempts){this.onDisconnected?.("Max reconnection attempts reached");return}let t=Math.min(1e3*2**this.reconnectAttempts,3e4);this.reconnectAttempts++,this.reconnectTimer=setTimeout(()=>this.doConnect(),t)}handleMessage(t){switch(t.type){case"FULL_STATE":this.onFullState?.(t.data);break;case"ROUND_START":this.onRoundStart?.(t.data);break;case"CHALLENGE":this.onChallenge?.(t.data);break;case"RESPONSE":this.onResponse?.(t.data);break;case"ELIMINATION":this.onElimination?.(t.data);break;case"GAME_END":this.onGameEnd?.(t.data);break;case"ERROR":this.onError?.(t.data);break}}};function O(r){let t=!1;function s(){let i=[...g.getState().gameState?.agents??[]].sort((l,h)=>h.score-l.score),m=e("aside",{class:`scoreboard${t?" collapsed":""}`,"aria-label":"Scoreboard"}),v=e("button",{class:"scoreboard-toggle",type:"button","aria-label":t?"Expand scoreboard":"Collapse scoreboard"},t?"\u25B6":"\u25BC");v.addEventListener("click",()=>{t=!t,s()});let u=e("div",{class:"scoreboard-header"},e("h2",{},"\u{1F3C6} Scores"),v);m.append(u);let c=e("div",{class:"scoreboard-list",role:"list"});i.forEach((l,h)=>{let a=e("div",{class:`scoreboard-entry${l.eliminated?" eliminated":""}`,role:"listitem","aria-label":`${l.name}: ${l.score} points${l.eliminated?", eliminated":""}`},e("span",{class:"rank"},`${h+1}.`),e("span",{class:"agent-emoji"},l.avatar??"\u{1F916}"),e("span",{class:"agent-info"},e("span",{class:"agent-name"},l.name)),e("span",{class:"score"},String(l.score)));c.append(a)}),m.append(c),p(r,m)}g.subscribe(s),s()}function _(r){return r.replace(/<[^>]*>/g,"")}function E(r,t=500){let s=_(r);return s.length>t?s.slice(0,t)+"\u2026":s}var F={debate:"\u{1F5E3}\uFE0F",strategy:"\u265F\uFE0F",creative:"\u{1F3A8}",trivia:"\u{1F4DA}"};function M(r,t){let s=[],n=e("article",{class:"challenge-display"},e("div",{class:"challenge-type"},`${F[t.type]??"\u2753"} ${t.type}`),e("p",{class:"challenge-description"},E(t.description)));if(s.push(n),t.responses&&t.responses.length>0){let o=e("div",{class:"response-list","aria-label":"Agent responses",role:"list"});for(let i of t.responses){let m=e("article",{class:"response-card",role:"listitem"},e("div",{class:"agent-name"},i.agentDisplayId),e("p",{class:"response-text"},E(i.response)),e("div",{class:"response-score"},`Score: ${i.score}`));o.append(m)}s.push(o)}p(r,...s)}function H(r,t,s,n){let i=`https://soulvssoul.com/game/${encodeURIComponent(n)}`,m=`\u{1F3C6} ${t} just dominated in Soul vs Soul! ${s} points | Watch the next battle \u2192`,v=`https://twitter.com/intent/tweet?text=${encodeURIComponent(m)}&url=${encodeURIComponent(i)}`,u=e("span",{class:"x-logo","aria-hidden":"true"},"\u{1D54F}"),c=e("a",{class:"btn btn-share",href:v,target:"_blank",rel:"noopener noreferrer","aria-label":"Share results on X"},u," Share to X"),l=e("button",{class:"btn btn-secondary",type:"button","aria-label":"Copy game link"},"\u{1F517} Copy Link");l.addEventListener("click",()=>{let a=`${location.origin}/#/game/${encodeURIComponent(n)}`;navigator.clipboard.writeText(a).then(()=>{l.textContent="\u2705 Copied!",setTimeout(()=>{l.textContent="\u{1F517} Copy Link"},2e3)})});let h=e("section",{class:"share-card"},e("h3",{},"Share Your Victory"),e("p",{class:"share-text"},`${t} dominated with ${s} points!`),e("div",{class:"share-actions"},c,l));p(r,h)}function j(r,t){let s=new A,n=null,o=!1,i="",m=0,v=e("div",{class:"game-layout"}),u=e("div",{class:"game-arena"}),c=e("div",{});v.append(u,c),p(r,v),O(c),s.onFullState=a=>{n=a,g.update({gameState:a,agents:a.agents}),l()},s.onRoundStart=a=>{n&&(n.round=a.round,g.update({gameState:{...n}})),l()},s.onChallenge=a=>{n&&(n.currentChallenge={type:a.challenge.type,description:a.challenge.publicDescription,responses:[]},g.update({gameState:{...n}})),l()},s.onResponse=a=>{if(n?.currentChallenge){n.currentChallenge.responses||(n.currentChallenge.responses=[]),n.currentChallenge.responses.push({agentDisplayId:a.agentId,response:E(a.response),score:a.score});let d=n.agents.find(f=>f.displayId===a.agentId);d&&(d.score+=a.score),g.update({gameState:{...n}})}l()},s.onElimination=a=>{if(n){let d=n.agents.find(f=>f.displayId===a.agentId);d&&(d.eliminated=!0),g.update({gameState:{...n}})}l()},s.onGameEnd=a=>{o=!0,i=a.winner.name,m=a.winner.score,l()},s.onConnectionChange=a=>{g.update({connected:a});let d=document.getElementById("connection-status");d&&(d.textContent=a?"\u{1F7E2} Live":"\u{1F534} Reconnecting\u2026",d.className=`connection-status ${a?"connected":"disconnected"}`)},s.onError=a=>{let d=e("p",{class:"error",role:"alert"},`Error: ${a.message}`);u.append(d)},s.onDisconnected=a=>{let d=e("p",{class:"error",role:"alert"},`Disconnected: ${a}`);u.append(d)};function l(){let a=[];if(o){let f=e("section",{class:"game-end"},e("h2",{},"\u{1F3C6} Game Over!"),e("p",{class:"winner-name"},i),e("p",{},`Score: ${m}`));a.push(f);let G=e("div",{});a.push(G),p(u,...a),H(G,i,m,t);return}if(!n){a.push(e("p",{},"Connecting to game\u2026")),p(u,...a);return}let d=e("header",{class:"arena-header"},e("span",{class:"round-indicator"},`Round ${n.round}`),e("span",{class:"spectator-count","aria-label":"Spectator count"},`\u{1F441} ${n.spectatorCount}`));if(a.push(d),n.currentChallenge){let f=e("div",{});a.push(f),p(u,...a),M(f,n.currentChallenge);return}a.push(e("p",{class:"waiting"},"Waiting for next challenge\u2026")),p(u,...a)}s.connect(t);let h=g.subscribe(()=>{g.getState().route.includes(t)||(s.disconnect(),h())})}var b=document.getElementById("app"),S=new w;S.add("/",()=>{g.update({route:"#/"}),$(b,()=>{location.hash="#/pick"})});S.add("/pick",()=>{g.update({route:"#/pick"}),U(b)});S.add("/game/:id",r=>{let t=r.id;t&&(g.update({route:`#/game/${t}`}),R(b,"Loading game\u2026"),T(t).then(s=>{s.status==="completed"?P(t).then(n=>{let o=e("section",{class:"game-results"},e("h1",{},"\u{1F3C6} Game Over"),e("p",{},`Status: ${n.status}`));n.winner&&o.append(e("p",{class:"winner-name"},`Winner: ${n.winner}`)),p(b,o)}).catch(n=>{y(b,n.message,()=>S.resolve())}):j(b,t)}).catch(s=>{y(b,s.message,()=>S.resolve())}))});S.add("/leaderboard",()=>{g.update({route:"#/leaderboard"});let r=e("section",{},e("h1",{},"\u{1F3C6} Leaderboard"),e("p",{},"Coming soon\u2026"));p(b,r)});S.start();
